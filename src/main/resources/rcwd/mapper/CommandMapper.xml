<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="rcwd.mapper.CommandMapper">

    <select id="list" resultMap="commandMap">
        <include refid="selectSql"/>
    </select>

    <sql id="selectSql">
        SELECT
        <include refid="commandColumns"/>,
        <include refid="sourceColumns"/>,
        <include refid="destinationColumns"/>
        FROM rclonewatchdog.command c
        INNER JOIN rclonewatchdog.source s ON c.source = s.id
        INNER JOIN rclonewatchdog.destination d ON c.destination = d.id
    </sql>

    <select id="get" resultMap="commandMap">
        <include refid="selectSql"/>
        WHERE c.id = #{commandId}
    </select>

    <sql id="commandColumns">
        c.id cid,
        c.command ccommand,
        c.name cname,
        c.filters cfilters
    </sql>

    <sql id="sourceColumns">
        s.id sid,
        s.name sname,
        s.directory sdirectory
    </sql>

    <sql id="destinationColumns">
        d.id did,
        d.name dname,
        d.directory ddirectory,
        d.remote dremote
    </sql>

    <resultMap id="commandMap" type="rcwd.model.Command">
        <id property="id" column="cid" javaType="long"/>
        <result property="name" column="cname"/>
        <result property="command" column="ccommand"/>
        <result property="filters" column="cfilters"/>
        <association property="source" resultMap="sourceMap"/>
        <association property="destination" resultMap="destinationMap"/>
    </resultMap>

    <resultMap id="sourceMap" type="rcwd.model.Directory">
        <id property="id" column="sid"/>
        <result property="name" column="sname"/>
        <result property="directory" column="sdirectory"/>
    </resultMap>

    <resultMap id="destinationMap" type="rcwd.model.Destination">
        <id property="id" column="did"/>
        <result property="name" column="dname"/>
        <result property="directory" column="ddirectory"/>
        <result property="remote" column="dremote"/>
    </resultMap>

</mapper>